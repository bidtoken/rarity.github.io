(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[953],{64730:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return D}});var a=n(83789),r=n(30266),i=n(809),u=n.n(i),s=n(67294),o=n(25675),l=n(41664),c=n(80318),p=n(87046),d=n(72787),m=n(84823),y=n(85893),f=(0,s.createContext)(),b=function(e){var t=e.children,n=e.adventurer,a=(0,p.ZP)(),i=a.chainID,o=a.provider,l=(0,s.useState)({}),b=l[0],v=l[1];function h(){var e=new d.CH("0x7A4045eb347D3300CDc7bd030B2A98b23599A995",[{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"from",type:"uint256"},{indexed:!0,internalType:"uint256",name:"to",type:"uint256"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"from",type:"uint256"},{indexed:!0,internalType:"uint256",name:"to",type:"uint256"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[{internalType:"uint256",name:"_summoner",type:"uint256"}],name:"adventure",outputs:[{internalType:"uint256",name:"reward",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"adventurers_log",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"uint256",name:"",type:"uint256"}],name:"allowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"from",type:"uint256"},{internalType:"uint256",name:"spender",type:"uint256"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_dex",type:"uint256"}],name:"armor_class",outputs:[{internalType:"int256",name:"",type:"int256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"_class",type:"uint256"},{internalType:"uint256",name:"_str",type:"uint256"},{internalType:"uint256",name:"_level",type:"uint256"}],name:"attack_bonus",outputs:[{internalType:"int256",name:"",type:"int256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_class",type:"uint256"}],name:"base_attack_bonus_by_class",outputs:[{internalType:"uint256",name:"attack",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"_class",type:"uint256"},{internalType:"uint256",name:"_level",type:"uint256"}],name:"base_attack_bonus_by_class_and_level",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"_str",type:"uint256"}],name:"damage",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[],name:"dungeon_armor_class",outputs:[{internalType:"int256",name:"",type:"int256"}],stateMutability:"view",type:"function"},{inputs:[],name:"dungeon_damage",outputs:[{internalType:"int256",name:"",type:"int256"}],stateMutability:"view",type:"function"},{inputs:[],name:"dungeon_health",outputs:[{internalType:"int256",name:"",type:"int256"}],stateMutability:"view",type:"function"},{inputs:[],name:"dungeon_to_hit",outputs:[{internalType:"int256",name:"",type:"int256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_class",type:"uint256"}],name:"health_by_class",outputs:[{internalType:"uint256",name:"health",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"_class",type:"uint256"},{internalType:"uint256",name:"_level",type:"uint256"},{internalType:"uint32",name:"_const",type:"uint32"}],name:"health_by_class_and_level",outputs:[{internalType:"uint256",name:"health",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"_attribute",type:"uint256"}],name:"modifier_for_attribute",outputs:[{internalType:"int256",name:"_modifier",type:"int256"}],stateMutability:"pure",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_summoner",type:"uint256"}],name:"scout",outputs:[{internalType:"uint256",name:"reward",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"int256",name:"_attack_bonus",type:"int256"}],name:"to_hit_ac",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"pure",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"from",type:"uint256"},{internalType:"uint256",name:"to",type:"uint256"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"executor",type:"uint256"},{internalType:"uint256",name:"from",type:"uint256"},{internalType:"uint256",name:"to",type:"uint256"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transferFrom",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"}]);return[e.adventurers_log(n.tokenID),e.base_attack_bonus_by_class_and_level(n.tokenID,n.level),e.armor_class(n.attributes.dexterity),e.attack_bonus(n.class,n.attributes.strength,n.level),e.health_by_class_and_level(n.class,n.level,n.attributes.constitution),e.damage(n.attributes.strength),e.dungeon_armor_class(),e.dungeon_damage(),e.dungeon_health(),e.dungeon_to_hit(),e.scout(n.tokenID)]}function x(e){return g.apply(this,arguments)}function g(){return(g=(0,r.Z)(u().mark((function e(t){var n,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,m.kB)(o,1337===Number(i));case 2:return n=e.sent,e.next=5,n.all(t);case 5:return a=e.sent,e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){var t=(0,c.Z)(e,11),a=t[0],r=t[1],i=t[2],u=t[3],s=t[4],o=t[5],l=t[6],p=t[7],d=t[8],m=t[9],y=t[10];v({tokenID:n.tokenID,log:Number(a),adventurerBaseAttack:Number(r),adventurerArmor:Number(i),adventurerBonusAttack:Number(u),adventurerHealth:Number(s),adventurerDamage:Number(o),dungeonArmor:Number(l),dungeonDamage:Number(p),dungeonHealth:Number(d),dungeonToHit:Number(m),scout:Number(y)})}function k(){return(k=(0,r.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(h());case 2:T(e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return(0,s.useEffect)((function(){n.tokenID&&function(){k.apply(this,arguments)}()}),[n.tokenID]),(0,y.jsx)(f.Provider,{value:{dungeon:b},children:t})},v=function(){return(0,s.useContext)(f)},h=n(80496),x=n(627),g=n(39185),T=n(71637),k=["","/classes/back/barbarian.svg","/classes/back/bard.png","/classes/back/cleric.png","/classes/back/druid.png","/classes/back/fighter.png","/classes/back/monk.svg","/classes/back/paladin.png","/classes/back/ranger.png","/classes/back/rogue.png","/classes/back/sorcerer.png","/classes/back/wizard.png"];function _(e){return new Promise((function(t){return setTimeout(t,e)}))}function w(e){var t=e.router,n=e.step,a=e.stepAuto,r=e.ratEscaped,i=e.adventurerWon,u=e.expectedLoot,s=e.loot;return r?(0,y.jsx)(T.Z,{options:[{label:"THE BIG UGLY RAT HAS ESCAPED",onClick:function(){return t.push("/countryside/cellar")}}]}):i?0===u?(0,y.jsx)(T.Z,{options:[{label:"YOU HAVE DEFEATED THE RAT ! UNFORTUNATELY, THERE IS NOTHING TO RECOVER",onClick:function(){return t.push("/countryside/cellar")}}]}):(0,y.jsx)(T.Z,{options:[{label:"YOU HAVE DEFEATED THE RAT ! YOU CAN LOOT ".concat(u," SKIN").concat(u>0?"s":""),onClick:s}]}):(0,y.jsx)(T.Z,{options:[{label:"FIGHT",onClick:n},{label:"FIGHT (AUTO)",onClick:a},{label:"ESCAPE",onClick:function(){return t.push("/countryside/cellar")}}]})}function N(e){var t=e.dungeon,n=e.adventurer,i=e.router,c=(0,h.ZP)().raritySkins,d=(0,p.ZP)().provider,m=(0,x.ZP)(),f=m.updateRarity,b=m.skins,v=(0,s.useState)(0),T=v[0],N=v[1],j=(0,s.useState)(0),D=j[0],A=j[1],E=(0,s.useState)(!1),H=E[0],M=E[1],Z=(0,s.useState)(!1),I=Z[0],C=Z[1],R=(0,s.useState)(t.adventurerHealth),S=R[0],U=R[1],O=(0,s.useState)(t.dungeonHealth),P=O[0],B=O[1],F=(0,s.useState)([]),Y=F[0],q=F[1],L=k[null===n||void 0===n?void 0:n.class],W=c&&b[null===n||void 0===n?void 0:n.tokenID]||L;function G(){return(G=(0,r.Z)(u().mark((function e(){var r,i,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:A(1),r=S,i=P,s=10;case 4:if(!(s>=T)){e.next=26;break}if(B((function(e){return e-t.adventurerDamage})),!((i-=t.adventurerDamage)<=0)){e.next=11;break}return q((function(e){return[].concat((0,a.Z)(e),["Facu will be happy, you killed this Ugly rat!"])})),C(!0),e.abrupt("return",!0);case 11:return q((function(e){return[].concat((0,a.Z)(e),["".concat((null===n||void 0===n?void 0:n.name)||"Your adventurer"," attacks the Big Ugly Rat and deals ").concat(t.adventurerDamage," dmg.")])})),e.next=14,_(0);case 14:if(!(t.adventurerArmor<t.dungeonToHit)){e.next=20;break}if(U((function(e){return e-t.dungeonDamage})),!((r-=t.dungeonDamage)<=0)){e.next=20;break}return q((function(e){return[].concat((0,a.Z)(e),["".concat((null===n||void 0===n?void 0:n.name)||"Your adventurer"," fades out")])})),e.abrupt("return",!1);case 20:return q((function(e){return[].concat((0,a.Z)(e),["The Big Ugly Rat attacks your adventurer and deals ".concat(t.dungeonDamage," dmg.")])})),e.next=23,_(0);case 23:s--,e.next=4;break;case 26:q((function(e){return[].concat((0,a.Z)(e),["The big ugly rat escaped"])})),M(!0);case 28:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(){return(V=(0,r.Z)(u().mark((function e(){var r,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==D){e.next=2;break}return e.abrupt("return");case 2:if(A(0),r=S,i=P,10!==T){e.next=9;break}return q((function(e){return[].concat((0,a.Z)(e),["The big ugly rat escaped"])})),M(!0),e.abrupt("return");case 9:if(B((function(e){return e-t.adventurerDamage})),!((i-=t.adventurerDamage)<=0)){e.next=15;break}return q((function(e){return[].concat((0,a.Z)(e),["Facu will be happy, you killed this Ugly rat!"])})),C(!0),e.abrupt("return",!0);case 15:return q((function(e){return[].concat((0,a.Z)(e),["".concat((null===n||void 0===n?void 0:n.name)||"Your adventurer"," attacks the Big Ugly Rat and deals ").concat(t.adventurerDamage," dmg.")])})),e.next=18,_(450);case 18:if(!(t.adventurerArmor<t.dungeonToHit)){e.next=24;break}if(U((function(e){return e-t.dungeonDamage})),!((r-=t.dungeonDamage)<=0)){e.next=24;break}return q((function(e){return[].concat((0,a.Z)(e),["".concat((null===n||void 0===n?void 0:n.name)||"Your adventurer"," fades out")])})),e.abrupt("return",!1);case 24:return q((function(e){return[].concat((0,a.Z)(e),["The Big Ugly Rat attacks your adventurer and deals ".concat(t.dungeonDamage," dmg.")])})),e.next=27,_(450);case 27:N((function(e){return e+1}));case 28:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return(0,s.useEffect)((function(){U(t.adventurerHealth),B(t.dungeonHealth)}),[t]),(0,y.jsxs)("section",{className:"relative",children:[(0,y.jsxs)("div",{className:"absolute bg-black inset-0 z-10 -top-24 -left-4 -right-4 flex flex-col items-center min-h-screen transition-opacity duration-1000 ".concat(S<=0?"opacity-100":"opacity-0 pointer-events-none"),children:[(0,y.jsx)("p",{className:"text-2xl text-white pt-20 mx-4 md:mx-0 md:pt-64 max-w-screen-sm text-center",children:"you passed out"}),(0,y.jsx)("p",{className:"text-base text-white pt-8 mx-4 md:mx-0 max-w-screen-sm text-center",children:"After some time, the rat returns to his hole and Facu the tavernkeeper, worried, finds you lying on the floor"}),(0,y.jsx)(l.default,{href:"/countryside/cellar",children:(0,y.jsx)("div",{className:"text-base text-white mt-16 mx-4 md:mx-0 py-2 px-4 max-w-screen-sm text-center animate-pulse border-t-4 border-b-4 border-white hover:bg-white hover:text-black transition-colors cursor-pointer hover:animate-none",style:{cursor:"pointer"},children:"Rest weak adventurer, Rest..."})})]}),(0,y.jsx)("div",{className:"max-w-screen-sm w-full mx-auto mt-12",children:(0,y.jsxs)("div",{className:"flex flex-col items-center",children:[(0,y.jsxs)("div",{className:"w-full flex flex-row ml-0 md:ml-32",children:[(0,y.jsxs)("div",{className:"w-full mr-14",children:[(0,y.jsx)("p",{className:"whitespace-nowrap",children:"Big Ugly Rat"}),(0,y.jsxs)("div",{className:"flex flex-row items-center w-full py-2",children:[(0,y.jsx)("div",{className:"text-opacity-80 text-black dark:text-white text-sm w-32",children:"HP:"}),(0,y.jsx)("progress",{className:"border-solid border-2 border-black dark:border-dark-400 p-1.5 nes-progress is-error w-full transition-all",value:P,max:t.dungeonHealth})]})]}),(0,y.jsx)("div",{className:"w-60 hidden md:block transform",style:{transform:P<=0?"rotate3d(0, 1, 0, 0deg)":"rotate3d(0, 1, 0, 180deg)",minWidth:240,opacity:H?0:100},children:(0,y.jsx)(o.default,{src:P<=0?"/dungeons/rat_dead.png":"/dungeons/rat.gif",loading:"eager",quality:100,width:240,height:141})}),(0,y.jsx)("div",{className:"w-30 block md:hidden transform",style:{transform:P<=0?"rotate3d(0, 1, 0, 0deg)":"rotate3d(0, 1, 0, 180deg)",minWidth:120,opacity:H?0:100},children:(0,y.jsx)(o.default,{src:P<=0?"/dungeons/rat_dead.png":"/dungeons/rat.gif",loading:"eager",quality:100,width:120,height:70.5})})]}),(0,y.jsxs)("div",{className:"w-full flex flex-row mt-2 md:-mt-10 mr-0 md:mr-32",children:[(0,y.jsx)("div",{className:"w-60 hidden md:block",style:{minWidth:240},children:(0,y.jsx)(o.default,{src:W,loading:"eager",quality:100,width:240,height:240})}),(0,y.jsx)("div",{className:"w-32 block md:hidden",style:{minWidth:120},children:(0,y.jsx)(o.default,{src:W,loading:"eager",quality:100,width:120,height:120})}),(0,y.jsxs)("div",{className:"w-full mt-auto mb-2",children:[(0,y.jsx)("p",{children:t.tokenID}),(0,y.jsxs)("div",{className:"flex flex-row items-center w-full py-2",children:[(0,y.jsx)("div",{className:"text-opacity-80 text-black dark:text-white text-sm w-32",children:"HP:"}),(0,y.jsx)("progress",{className:"nes-progress border-solid border-2 border-black dark:border-dark-400 p-1.5 is-success w-full transition-all",value:S,max:t.adventurerHealth})]})]})]})]})}),(0,y.jsx)("div",{className:"max-w-screen-md w-full mx-auto",children:(0,y.jsx)(w,{router:i,step:function(){return V.apply(this,arguments)},stepAuto:function(){return G.apply(this,arguments)},ratEscaped:H,adventurerWon:I,expectedLoot:t.scout,loot:function(){(0,g.yL)({provider:d,contractAddress:"0x7A4045eb347D3300CDc7bd030B2A98b23599A995",tokenID:t.tokenID},(function(e){var n=e.error;if(n)return console.error(n);f(t.tokenID),"/dungeons/the-cellar"===i.pathname&&i.push("/countryside/cellar")}))}})}),(0,y.jsx)("div",{className:"max-w-screen-md w-full mx-auto",children:(0,y.jsx)("div",{className:"space-y-4 text-center",children:Y.map((function(e,t){return(0,y.jsx)("p",{className:"text-sx",children:e},t)}))})})]})}function j(e){var t=e.router,n=e.adventurer,a=v().dungeon;return a.adventurerHealth&&a.dungeonHealth?(0,y.jsx)(N,{router:t,dungeon:a,adventurer:n}):null}var D=function(e){var t,n,a,r=e.rarities,i=e.router;return r&&r!=={}?r[null===i||void 0===i||null===(t=i.query)||void 0===t?void 0:t.adventurer]?(0,y.jsx)(b,{adventurer:r[null===i||void 0===i||null===(n=i.query)||void 0===n?void 0:n.adventurer],children:(0,y.jsx)(j,{router:i,adventurer:r[null===i||void 0===i||null===(a=i.query)||void 0===a?void 0:a.adventurer]})}):(i.push("/"),null):null}},40661:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dungeons/the-cellar",function(){return n(64730)}])}},function(e){e.O(0,[185,774,888,179],(function(){return t=40661,e(e.s=t);var t}));var t=e.O();_N_E=t}]);